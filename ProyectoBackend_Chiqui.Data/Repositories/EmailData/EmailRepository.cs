using MailKit.Net.Smtp;
using MimeKit;
using MimeKit.Text;
using ProyectoBackend_Chiqui.Model;
using ProyectoBackend_Chiqui.Model.Funciones;
using System;
using System.Collections.Generic;
using System.Configuration.Internal;
using System.Linq;
using System.Net.Mail;
using System.Text;
using System.Threading.Tasks;

namespace ProyectoBackend_Chiqui.Data.Repositories.EmailData
{
    public class EmailRepository : IEmailRepository
    {
        private readonly EmailConfiguration _Email;
        public EmailRepository(EmailConfiguration email)
        {
            _Email = email;
        }
        public void BienvenidaEmail(EmailModel email)
        {
            // Configurar el correo electrónico
            email.Subject = "Bienvenido (a)";
            var Email = new MimeMessage();
            Email.From.Add(MailboxAddress.Parse(_Email.User));  // Remitente
            Email.To.Add(MailboxAddress.Parse(email.To));       // Destinatario
            Email.Subject = email.Subject;                      // Asunto
                                                                // Leer el contenido del archivo HTML
            string htmlBody = "<!DOCTYPE html>\r\n<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" lang=\"en\">\r\n\r\n<head>\r\n    <title></title>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><!--[if mso]><xml><o:OfficeDocumentSettings><o:PixelsPerInch>96</o:PixelsPerInch><o:AllowPNG/></o:OfficeDocumentSettings></xml><![endif]--><!--[if !mso]><!--><!--<![endif]-->\r\n    <style>\r\n        * {\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        body {\r\n            margin: 0;\r\n            padding: 0;\r\n        }\r\n\r\n        a[x-apple-data-detectors] {\r\n            color: inherit !important;\r\n            text-decoration: inherit !important;\r\n        }\r\n\r\n        #MessageViewBody a {\r\n            color: inherit;\r\n            text-decoration: none;\r\n        }\r\n\r\n        p {\r\n            line-height: inherit\r\n        }\r\n\r\n        .desktop_hide,\r\n        .desktop_hide table {\r\n            mso-hide: all;\r\n            display: none;\r\n            max-height: 0px;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .image_block img + div {\r\n            display: none;\r\n        }\r\n\r\n        sup,\r\n        sub {\r\n            line-height: 0;\r\n            font-size: 75%;\r\n        }\r\n\r\n        @media (max-width:580px) {\r\n            .desktop_hide table.icons-inner {\r\n                display: inline-block !important;\r\n            }\r\n\r\n            .icons-inner {\r\n                text-align: center;\r\n            }\r\n\r\n                .icons-inner td {\r\n                    margin: 0 auto;\r\n                }\r\n\r\n            .mobile_hide {\r\n                display: none;\r\n            }\r\n\r\n            .row-content {\r\n                width: 100% !important;\r\n            }\r\n\r\n            .stack .column {\r\n                width: 100%;\r\n                display: block;\r\n            }\r\n\r\n            .mobile_hide {\r\n                min-height: 0;\r\n                max-height: 0;\r\n                max-width: 0;\r\n                overflow: hidden;\r\n                font-size: 0px;\r\n            }\r\n\r\n            .desktop_hide,\r\n            .desktop_hide table {\r\n                display: table !important;\r\n                max-height: none !important;\r\n            }\r\n        }\r\n    </style><!--[if mso ]><style>sup, sub { font-size: 100% !important; } sup { mso-text-raise:10% } sub { mso-text-raise:-10% }</style> <![endif]-->\r\n</head>\r\n\r\n<body class=\"body\" style=\"margin: 0; background-color: #ffffff; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;\">\r\n    <table class=\"nl-container\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;\">\r\n        <tbody>\r\n            <tr>\r\n                <td>\r\n                    <table class=\"row row-1\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #7e2424;\">\r\n                        <tbody>\r\n                            <tr>\r\n                                <td>\r\n                                    <table class=\"row-content stack\" align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 560px; margin: 0 auto;\" width=\"560\">\r\n                                        <tbody>\r\n                                            <tr>\r\n                                                <td class=\"column column-1\" width=\"100%\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;\">\r\n                                                    <table class=\"image_block block-1\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\" style=\"width:100%;padding-right:0px;padding-left:0px;\">\r\n                                                                <div class=\"alignment\" align=\"center\" style=\"line-height:10px\">\r\n                                                                    <div style=\"max-width: 168px;\"><img src=\"https://static.wixstatic.com/media/ec2146_31b21e89d5934873bbd85f5c867f6ffb~mv2.png/v1/fill/w_170,h_121,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/WhatsApp_Image_2024-05-18_at_3_54_54_PM-removebg-preview.png\" style=\"display: block; height: auto; border: 0; width: 100%;\" width=\"168\" height=\"auto\"></div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    <table class=\"row row-2\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                        <tbody>\r\n                            <tr>\r\n                                <td>\r\n                                    <table class=\"row-content stack\" align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-radius: 0; color: #000000; width: 560px; margin: 0 auto;\" width=\"560\">\r\n                                        <tbody>\r\n                                            <tr>\r\n                                                <td class=\"column column-1\" width=\"100%\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;\">\r\n                                                    <table class=\"heading_block block-1\" width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\">\r\n                                                                <h1 style=\"margin: 0; color: #1e0e4b; direction: ltr; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 38px; font-weight: 700; letter-spacing: normal; line-height: 120%; text-align: center; margin-top: 0; margin-bottom: 0; mso-line-height-alt: 45.6px;\"><strong><span class=\"tinyMce-placeholder\" style=\"word-break: break-word;\">¡ Bienvenido a Chiqui !</span></strong></h1>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                    <table class=\"heading_block block-2\" width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\">\r\n                                                                <h1 style=\"margin: 0; color: #1e0e4b; direction: ltr; font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif; font-size: 17px; font-weight: 400; letter-spacing: normal; line-height: 120%; text-align: center; margin-top: 0; margin-bottom: 0; mso-line-height-alt: 20.4px;\">¡Bienvenido a nuestro sistema de pedidos de carne! Nos alegra que te hayas unido a nuestra comunidad. Aquí encontrarás la mejor selección de cortes de carne frescos y de alta calidad, listos para ser entregados. Nuestro objetivo es hacer tu experiencia de compra sencilla, rápida y satisfactoria.</h1>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                    <table class=\"button_block block-3\" width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\">\r\n                                                                <div class=\"alignment\" align=\"center\">\r\n                                                                    <!--[if mso]>\r\n                                                                    <v:roundrect xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" href=\"https://rsolorzanomarroqui.wixsite.com/chiqui\" style=\"height:42px;width:111px;v-text-anchor:middle;\" arcsize=\"10%\" stroke=\"false\" fillcolor=\"#7e2424\">\r\n                                                                    <w:anchorlock/>\r\n                                                                    <v:textbox inset=\"0px,0px,0px,0px\">\r\n                                                                    <center dir=\"false\" style=\"color:#ffffff;font-family:Arial, sans-serif;font-size:16px\">\r\n                                                                    <![endif]-->\r\n                                                                    <a href=\"https://front-carninceria-chiqui.vercel.app/auth/inicio\" target=\"_blank\" style=\"background-color:#7e2424;border-bottom:0px solid transparent;border-left:0px solid transparent;border-radius:4px;border-right:0px solid transparent;border-top:0px solid transparent;color:#ffffff;display:inline-block;font-family:Arial, 'Helvetica Neue', Helvetica, sans-serif;font-size:16px;font-weight:400;mso-border-alt:none;padding-bottom:5px;padding-top:5px;text-align:center;text-decoration:none;width:auto;word-break:keep-all;\"><span style=\"word-break: break-word; padding-left: 20px; padding-right: 20px; font-size: 16px; display: inline-block; letter-spacing: normal;\"><span style=\"word-break: break-word; line-height: 32px;\">Ir a tienda</span></span></a><!--[if mso]></center></v:textbox></v:roundrect><![endif]-->\r\n                                                                </div>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    <table class=\"row row-3\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;\">\r\n                        <tbody>\r\n                            <tr>\r\n                                <td>\r\n                                    <table class=\"row-content stack\" align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff; color: #000000; width: 560px; margin: 0 auto;\" width=\"560\">\r\n                                        <tbody>\r\n                                            <tr>\r\n                                                <td class=\"column column-1\" width=\"100%\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;\">\r\n                                                    <table class=\"icons_block block-1\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; text-align: center; line-height: 0;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\" style=\"vertical-align: middle; color: #1e0e4b; font-family: 'Inter', sans-serif; font-size: 15px; padding-bottom: 5px; padding-top: 5px; text-align: center;\">\r\n                                                                <!--[if vml]><table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"display:inline-block;padding-left:0px;padding-right:0px;mso-table-lspace: 0pt;mso-table-rspace: 0pt;\"><![endif]-->\r\n                                                                <!--[if !vml]><!-->\r\n                                                                <table class=\"icons-inner\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; display: inline-block; padding-left: 0px; padding-right: 0px;\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\r\n                                                                    <!--<![endif]-->\r\n                                                                    <tr>\r\n                                                                        <td style=\"vertical-align: middle; text-align: center; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 6px;\"><a href=\"http://designedwithbeefree.com/\" target=\"_blank\" style=\"text-decoration: none;\"><img class=\"icon\" alt=\"Beefree Logo\" src=\"https://d1oco4z2z1fhwp.cloudfront.net/assets/Beefree-logo.png\" height=\"auto\" width=\"34\" align=\"center\" style=\"display: block; height: auto; margin: 0 auto; border: 0;\"></a></td>\r\n                                                                        <td style=\"font-family: 'Inter', sans-serif; font-size: 15px; font-weight: undefined; color: #1e0e4b; vertical-align: middle; letter-spacing: undefined; text-align: center; line-height: normal;\"><a href=\"http://designedwithbeefree.com/\" target=\"_blank\" style=\"color: #1e0e4b; text-decoration: none;\">Designed with Beefree</a></td>\r\n                                                                    </tr>\r\n                                                                </table>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table><!-- End -->\r\n</body>\r\n\r\n</html>";

            Email.Body = new TextPart(TextFormat.Html)          // Cuerpo en HTML
            {
                Text = htmlBody
            };

            // Enviar el correo electrónico
            using var smtp = new MailKit.Net.Smtp.SmtpClient();
            try
            {
                smtp.Connect(_Email.Host, _Email.Port, MailKit.Security.SecureSocketOptions.StartTls);
                smtp.Authenticate(_Email.User, _Email.Pass);
                smtp.Send(Email);
            }
            finally
            {
                smtp.Disconnect(true);
            }
        }

        public void RecContraseña(string correo, string codigo)
        {
            string Subject = "Recuperar Contraseña";
            // Generar el código aleatorio
            

            // Configurar el correo electrónico
            var Email = new MimeMessage();
            Email.From.Add(MailboxAddress.Parse(_Email.User));  // Remitente
            Email.To.Add(MailboxAddress.Parse(correo));       // Destinatario
            Email.Subject = Subject;                      // Asunto
                                                                // Leer el contenido del archivo HTML
                                                                // Obtener el directorio base del proyecto
            string baseDirectory = AppDomain.CurrentDomain.BaseDirectory;

            string htmlBody = "<!DOCTYPE html>\r\n<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" lang=\"en\">\r\n\r\n<head>\r\n    <title></title>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><!--[if mso]><xml><o:OfficeDocumentSettings><o:PixelsPerInch>96</o:PixelsPerInch><o:AllowPNG/></o:OfficeDocumentSettings></xml><![endif]--><!--[if !mso]><!--><!--<![endif]-->\r\n    <style>\r\n        * {\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        body {\r\n            margin: 0;\r\n            padding: 0;\r\n        }\r\n\r\n        a[x-apple-data-detectors] {\r\n            color: inherit !important;\r\n            text-decoration: inherit !important;\r\n        }\r\n\r\n        #MessageViewBody a {\r\n            color: inherit;\r\n            text-decoration: none;\r\n        }\r\n\r\n        p {\r\n            line-height: inherit\r\n        }\r\n\r\n        .desktop_hide,\r\n        .desktop_hide table {\r\n            mso-hide: all;\r\n            display: none;\r\n            max-height: 0px;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .image_block img + div {\r\n            display: none;\r\n        }\r\n\r\n        sup,\r\n        sub {\r\n            line-height: 0;\r\n            font-size: 75%;\r\n        }\r\n\r\n        @media (max-width:620px) {\r\n            .desktop_hide table.icons-inner {\r\n                display: inline-block !important;\r\n            }\r\n\r\n            .icons-inner {\r\n                text-align: center;\r\n            }\r\n\r\n                .icons-inner td {\r\n                    margin: 0 auto;\r\n                }\r\n\r\n            .mobile_hide {\r\n                display: none;\r\n            }\r\n\r\n            .row-content {\r\n                width: 100% !important;\r\n            }\r\n\r\n            .stack .column {\r\n                width: 100%;\r\n                display: block;\r\n            }\r\n\r\n            .mobile_hide {\r\n                min-height: 0;\r\n                max-height: 0;\r\n                max-width: 0;\r\n                overflow: hidden;\r\n                font-size: 0px;\r\n            }\r\n\r\n            .desktop_hide,\r\n            .desktop_hide table {\r\n                display: table !important;\r\n                max-height: none !important;\r\n            }\r\n        }\r\n    </style><!--[if mso ]><style>sup, sub { font-size: 100% !important; } sup { mso-text-raise:10% } sub { mso-text-raise:-10% }</style> <![endif]-->\r\n</head>\r\n\r\n<body class=\"body\" style=\"background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;\">\r\n    <table class=\"nl-container\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;\">\r\n        <tbody>\r\n            <tr>\r\n                <td>\r\n                    <table class=\"row row-1\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #7e2424;\">\r\n                        <tbody>\r\n                            <tr>\r\n                                <td>\r\n                                    <table class=\"row-content stack\" align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 600px; margin: 0 auto;\" width=\"600\">\r\n                                        <tbody>\r\n                                            <tr>\r\n                                                <td class=\"column column-1\" width=\"100%\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;\">\r\n                                                    <table class=\"image_block block-1\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\" style=\"width:100%;\">\r\n                                                                <div class=\"alignment\" align=\"center\" style=\"line-height:10px\">\r\n                                                                    <div style=\"max-width: 170px;\"><img src=\"https://static.wixstatic.com/media/ec2146_31b21e89d5934873bbd85f5c867f6ffb~mv2.png/v1/fill/w_170,h_121,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/WhatsApp_Image_2024-05-18_at_3_54_54_PM-removebg-preview.png\" style=\"display: block; height: auto; border: 0; width: 100%;\" width=\"170\" height=\"auto\"></div>\r\n                                                                </div>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    <table class=\"row row-2\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                        <tbody>\r\n                            <tr>\r\n                                <td>\r\n                                    <table class=\"row-content stack\" align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-radius: 0; color: #000000; width: 600px; margin: 0 auto;\" width=\"600\">\r\n                                        <tbody>\r\n                                            <tr>\r\n                                                <td class=\"column column-1\" width=\"100%\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;\">\r\n                                                    <table class=\"heading_block block-1\" width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\">\r\n                                                                <h1 style=\"margin: 0; color: #2c2b2f; direction: ltr; font-family: Arial, Helvetica, sans-serif; font-size: 23px; font-weight: 700; letter-spacing: normal; line-height: 120%; text-align: left; margin-top: 0; margin-bottom: 0; mso-line-height-alt: 27.599999999999998px;\">Para verificar tu identidad, usa el siguiente código:</h1>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                    <table class=\"heading_block block-2\" width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\">\r\n                                                                <h1 style=\"margin: 0; color: #000000; direction: ltr; font-family: Arial, Helvetica, sans-serif; font-size: 38px; font-weight: 700; letter-spacing: normal; line-height: 120%; text-align: center; margin-top: 0; margin-bottom: 0; mso-line-height-alt: 45.6px;\"><span class=\"tinyMce-placeholder\" style=\"word-break: break-word;\">"+codigo+"</span></h1>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                    <table class=\"heading_block block-3\" width=\"100%\" border=\"0\" cellpadding=\"10\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\">\r\n                                                                <h1 style=\"margin: 0; color: #000000; direction: ltr; font-family: Arial, Helvetica, sans-serif; font-size: 14px; font-weight: 400; letter-spacing: normal; line-height: 120%; text-align: left; margin-top: 0; margin-bottom: 0; mso-line-height-alt: 16.8px;\">Por tu seguridad, es muy importante que no compartas el código de cambio de contraseña con nadie. Este código es personal y confidencial, y su divulgación podría comprometer tu cuenta. Si alguien te pide este código, no lo proporciones. Si crees que alguien ha tenido acceso no autorizado a tu cuenta, por favor, contáctanos de inmediato para proteger tu información. ¡La seguridad de tu cuenta es nuestra prioridad!</h1>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                    <table class=\"row row-3\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;\">\r\n                        <tbody>\r\n                            <tr>\r\n                                <td>\r\n                                    <table class=\"row-content stack\" align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 600px; margin: 0 auto;\" width=\"600\">\r\n                                        <tbody>\r\n                                            <tr>\r\n                                                <td class=\"column column-1\" width=\"100%\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;\">\r\n                                                    <table class=\"icons_block block-1\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; text-align: center; line-height: 0;\">\r\n                                                        <tr>\r\n                                                            <td class=\"pad\" style=\"vertical-align: middle; color: #1e0e4b; font-family: 'Inter', sans-serif; font-size: 15px; padding-bottom: 5px; padding-top: 5px; text-align: center;\">\r\n                                                                <!--[if vml]><table align=\"center\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\" style=\"display:inline-block;padding-left:0px;padding-right:0px;mso-table-lspace: 0pt;mso-table-rspace: 0pt;\"><![endif]-->\r\n                                                                <!--[if !vml]><!-->\r\n                                                                <table class=\"icons-inner\" style=\"mso-table-lspace: 0pt; mso-table-rspace: 0pt; display: inline-block; padding-left: 0px; padding-right: 0px;\" cellpadding=\"0\" cellspacing=\"0\" role=\"presentation\">\r\n                                                                    <!--<![endif]-->\r\n                                                                    <tr>\r\n                                                                        <td style=\"vertical-align: middle; text-align: center; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 6px;\"><a href=\"http://designedwithbeefree.com/\" target=\"_blank\" style=\"text-decoration: none;\"><img class=\"icon\" alt=\"Beefree Logo\" src=\"https://d1oco4z2z1fhwp.cloudfront.net/assets/Beefree-logo.png\" height=\"auto\" width=\"34\" align=\"center\" style=\"display: block; height: auto; margin: 0 auto; border: 0;\"></a></td>\r\n                                                                        <td style=\"font-family: 'Inter', sans-serif; font-size: 15px; font-weight: undefined; color: #1e0e4b; vertical-align: middle; letter-spacing: undefined; text-align: center; line-height: normal;\"><a href=\"http://designedwithbeefree.com/\" target=\"_blank\" style=\"color: #1e0e4b; text-decoration: none;\">Designed with Beefree</a></td>\r\n                                                                    </tr>\r\n                                                                </table>\r\n                                                            </td>\r\n                                                        </tr>\r\n                                                    </table>\r\n                                                </td>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </td>\r\n                            </tr>\r\n                        </tbody>\r\n                    </table>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table><!-- End -->\r\n</body>\r\n\r\n</html>";


            Email.Body = new TextPart(TextFormat.Html)          // Cuerpo en HTML
            {
                Text = htmlBody
            };

            // Enviar el correo electrónico
            using var smtp = new MailKit.Net.Smtp.SmtpClient();
            try
            {
                smtp.Connect(_Email.Host, _Email.Port, MailKit.Security.SecureSocketOptions.StartTls);
                smtp.Authenticate(_Email.User, _Email.Pass);
                smtp.Send(Email);
            }
            finally
            {
                smtp.Disconnect(true);
            }
        }
    }
}
